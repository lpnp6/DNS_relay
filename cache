CACHED *findInCache(char *domainName) {
    CACHED *current = cacheHead;
    while (current != NULL) {
        if (strcmp(current->domainName, domainName) == 0) {
            return current;
        }
        current = current->nextCachedPtr;
    }
    return NULL;
}//找cache里面有没有
void addToCache(CACHED *newEntry) {
    newEntry->nextCachedPtr = cacheHead;
    cacheHead = newEntry;
}
void removeFromCache(CACHED *entry) {
    if (cacheHead == entry) {
        cacheHead = entry->nextCachedPtr;
        free(entry);
        return;
    }
void updateCacheTtl() {
    CACHED *current = cacheHead;
    while (current != NULL) {
        current->ttl--;
        if (current->ttl <= 0) {
            CACHED *next = current->nextCachedPtr;
            removeFromCache(current);
            current = next;
        } else {
            current = current->nextCachedPtr;
        }
    }
}
void handleDnsRequest(char *domainName，uint32_t ip) {
    CACHED *cacheEntry = findInCache(domainName);
    if (cacheEntry != NULL && cacheEntry->ttl > 0) {
        // Use cached result
        printf("Using cached result for %s\n", domainName);
    } else {
        // Query upstream DNS server and get result
        printf("Querying upstream DNS server for %s\n", domainName);

        // Add result to cache
        CACHED *newEntry = malloc(sizeof(CACHED));
        newEntry->ttl = 100; // Set TTL value as needed
        newEntry->domainName = strdup(domainName);
        newEntry->ipAddress=ip;
        addToCache(newEntry);
    }
}
